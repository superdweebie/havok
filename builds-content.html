<DIV class="container-fluid" >    <DIV class="row-fluid" >        <DIV class="span12 well" >            <DIV class="head" >                <H1 >Builds</H1>                <P >Make your production code small and fast.</P>            </DIV>        </DIV>    </DIV>    <DIV class="row-fluid" >        <DIV class="span3" >                            <UL data-dojo-attach-point="containerNode" class="nav nav-list well" id="serverParsed_6_0" dir="ltr" widgetId="serverParsed_6_0" data-dojo-type="docs/SideNav" data-dojo-props="&quot;_rendered&quot;:true" ><LI data-havok-handler-id="0" data-havok-spy-target="overview" ><A role="navitem" href="#overview" ><I style="line-height:20px" class="fa fa-chevron-right pull-right" ></I> Overview</A></LI><LI data-havok-handler-id="1" data-havok-spy-target="profile" ><A role="navitem" href="#profile" ><I style="line-height:20px" class="fa fa-chevron-right pull-right" ></I> Profile</A></LI><LI data-havok-handler-id="2" data-havok-spy-target="make" ><A role="navitem" href="#make" ><I style="line-height:20px" class="fa fa-chevron-right pull-right" ></I> Make</A></LI><LI data-havok-handler-id="3" data-havok-spy-target="deploy" ><A role="navitem" href="#deploy" ><I style="line-height:20px" class="fa fa-chevron-right pull-right" ></I> Deploy</A></LI></UL>                    </DIV>        <DIV class="span9" id="mainContent" >                <SECTION id="overview" title="Overview" ><DIV class="well" ><H1 >Overview</H1>
<P >Havok uses dojo's AMD loader to load modules, and has a handy ability to compile less client side. This makes development, unit testing and code reuse easy. However, it makes sites slow. An average havok page might load over 60+ separate javascript files, and compile 15 less files. All those requests take too long for a production environment.</P>
<P >Havok can utilize the dojo build system to create layers. Each layer consists of two parts:</P>
<UL >    <LI >A single compressed javascript file containing many AMD modules</LI>    <LI >A compressed css file that contains all the compiled less for the layer</LI></UL>
<P >To build havok layers you will require:<UL >    <LI >node.js installed</LI>    <LI >a <CODE >profile.js</CODE> that describes what should be built</LI></UL>
</P></DIV></SECTION>    <SECTION id="profile" title="Profile" ><DIV class="well" ><H1 >Profile</H1>
<P >A build profile is a js file that describes which packages will be built, which modules should be in any layers, and <I >lots</I> of other switches that can be used to tailor your layer for a specific runtime environment.</P>
<P >Dojo has many settings that can be used to refine the output of a build. Havok tries to simplify this for the most common usage.</P>
<P >The following outlines the properties of a simple build profile which will target the browser environment.</P>
<H2 >releaseDir</H2>
<P >A path relative to the profile where the build will be saved.</P>
<H2 >distDir (optional)</H2>
<P >A path relative to the profile where build layer js and css will be copied.</P>
<H2 >defaultConfig</H2>
<P >Values for <CODE >dojoConfig</CODE> that should be baked into the build. This would normally be set to:</P>
<PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="pln" >defaultConfig</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >{</SPAN></LI><LI class="L1" ><SPAN class="pln" >    deps</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L2" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/ready!'</SPAN></LI><LI class="L3" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L4" ><SPAN class="pln" >    merge</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L5" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/config'</SPAN></LI><LI class="L6" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >]</SPAN></LI><LI class="L7" ><SPAN class="pun" >}</SPAN></LI></OL></PRE>
<H2 >localeList</H2>
<P >A list of locales to be build. This would normally be set to:</P><PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="pln" >localeList</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN><SPAN class="str" >'en-gb'</SPAN><SPAN class="pun" >,</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >'en-us'</SPAN><SPAN class="pun" >]</SPAN></LI></OL></PRE>
<H2 >layers</H2>
<P >This is the most important aspect of defining a build profile. Each layer defines a single compressed js file with the included modules and their dependencies along with a compressed css file of all the less for that layer.</P>
<P >Bootable layers include the dojo loader. Non-bootable layers require the dojo loader to be loaded before they can be used.</P>
<H4 >Example layer definitions:</H4>
<P >A layer that includes the dojo loader, and nothing else:</P><PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="str" >"dojo/dojo"</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >{</SPAN></LI><LI class="L1" ><SPAN class="pln" >    include</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[],</SPAN></LI><LI class="L2" ><SPAN class="pln" >    customBase</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="lit" >1</SPAN></LI><LI class="L3" ><SPAN class="pun" >}</SPAN></LI></OL></PRE>
<P >A bootable layer that every single havok module. This layer will be the same as the havok distributable:</P><PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="str" >"havok/havok"</SPAN><SPAN class="pun" >:{</SPAN></LI><LI class="L1" ><SPAN class="pln" >    includeLocales</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN><SPAN class="str" >'en-gb'</SPAN><SPAN class="pun" >,</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >'en-us'</SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L2" ><SPAN class="pln" >    include</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L3" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/*'</SPAN></LI><LI class="L4" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L5" ><SPAN class="pln" >    boot</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="lit" >1</SPAN></LI><LI class="L6" ><SPAN class="pun" >}</SPAN></LI></OL></PRE>
<P >A bootable layer that include just the Select and TextBox form widgets:</P><PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="str" >"mylayer"</SPAN><SPAN class="pun" >:{</SPAN></LI><LI class="L1" ><SPAN class="pln" >    includeLocales</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN><SPAN class="str" >'en-gb'</SPAN><SPAN class="pun" >,</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >'en-us'</SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L2" ><SPAN class="pln" >    include</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L3" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/form/Select'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L4" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/form/TextBox'</SPAN></LI><LI class="L5" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L6" ><SPAN class="pln" >    boot</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="lit" >1</SPAN></LI><LI class="L7" ><SPAN class="pun" >}</SPAN></LI></OL></PRE>
<P >A pair of layers. One is the dojo loader, with a few foundational havok modules. The other can be loaded later with some specific widgets:</P><PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="str" >"dojo/dojo"</SPAN><SPAN class="pun" >:{</SPAN></LI><LI class="L1" ><SPAN class="pln" >    include</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L2" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/di/Di'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L3" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/widget/_WidgetBase'</SPAN></LI><LI class="L4" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L5" ><SPAN class="pln" >    customBase</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="lit" >1</SPAN></LI><LI class="L6" ><SPAN class="pun" >}</SPAN></LI><LI class="L7" ><SPAN class="str" >"mylayer"</SPAN><SPAN class="pun" >:{</SPAN></LI><LI class="L8" ><SPAN class="pln" >    includeLocales</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN><SPAN class="str" >'en-gb'</SPAN><SPAN class="pun" >,</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >'en-us'</SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L9" ><SPAN class="pln" >    include</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L0" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/form/ColorPicker'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L1" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/form/TextEditor'</SPAN></LI><LI class="L2" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L3" ><SPAN class="pln" >    exclude</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L4" ><SPAN class="pln" >        </SPAN><SPAN class="str" >"dojo/dojo"</SPAN></LI><LI class="L5" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >]</SPAN></LI><LI class="L6" ><SPAN class="pln" >    boot</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="lit" >1</SPAN></LI><LI class="L7" ><SPAN class="pun" >}</SPAN></LI></OL></PRE>
<P >A layer that includes every module in your own custom AMD package, and a few from Havok:</P><PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="str" >"mypackage/mypackage"</SPAN><SPAN class="pun" >:{</SPAN></LI><LI class="L1" ><SPAN class="pln" >    includeLocales</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN><SPAN class="str" >'en-gb'</SPAN><SPAN class="pun" >,</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >'en-us'</SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L2" ><SPAN class="pln" >    include</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L3" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'mypackage/*'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L4" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/ready'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L5" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/router/started'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L6" ><SPAN class="pln" >        </SPAN><SPAN class="str" >'havok/exception/started'</SPAN></LI><LI class="L7" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L8" ><SPAN class="pln" >    boot</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="lit" >1</SPAN></LI><LI class="L9" ><SPAN class="pun" >}</SPAN></LI></OL></PRE>
<H2 >Packages</H2>
<P >An array of AMD packages that should be built along with havok and dojo packages. Location must be a path relative to the profile.</P>
<PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="pln" >packages</SPAN><SPAN class="pun" >:[</SPAN></LI><LI class="L1" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >{</SPAN></LI><LI class="L2" ><SPAN class="pln" >        name</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >"mypackage"</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L3" ><SPAN class="pln" >        location</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >'../mypackage'</SPAN></LI><LI class="L4" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >}</SPAN></LI><LI class="L5" ><SPAN class="pun" >]</SPAN></LI></OL></PRE>
<H2 >Complete Example</H2>
<P >A complete build profile might look like this:</P>
<PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="kwd" >var</SPAN><SPAN class="pln" > profile </SPAN><SPAN class="pun" >=</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >{</SPAN></LI><LI class="L1" ><SPAN class="pln" >    releaseDir</SPAN><SPAN class="pun" >:</SPAN><SPAN class="str" >"../release"</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L2" ><SPAN class="pln" >    distDir</SPAN><SPAN class="pun" >:</SPAN><SPAN class="str" >"../dist"</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L3" ><SPAN class="pln" >    defaultConfig</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >{</SPAN></LI><LI class="L4" ><SPAN class="pln" >        deps</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L5" ><SPAN class="pln" >            </SPAN><SPAN class="str" >'havok/ready!'</SPAN></LI><LI class="L6" ><SPAN class="pln" >        </SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L7" ><SPAN class="pln" >        merge</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L8" ><SPAN class="pln" >            </SPAN><SPAN class="str" >'havok/config'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L9" ><SPAN class="pln" >            </SPAN><SPAN class="str" >'mypackage/config'</SPAN></LI><LI class="L0" ><SPAN class="pln" >        </SPAN><SPAN class="pun" >]</SPAN></LI><LI class="L1" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >},</SPAN></LI><LI class="L2" ><SPAN class="pln" >    localeList</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN><SPAN class="str" >'en-gb'</SPAN><SPAN class="pun" >,</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >'en-us'</SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L3" ><SPAN class="pln" >    layers</SPAN><SPAN class="pun" >:{</SPAN></LI><LI class="L4" ><SPAN class="pln" >        </SPAN><SPAN class="str" >"mypackage/mypackage"</SPAN><SPAN class="pun" >:{</SPAN></LI><LI class="L5" ><SPAN class="pln" >            includeLocales</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN><SPAN class="str" >'en-gb'</SPAN><SPAN class="pun" >,</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >'en-us'</SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L6" ><SPAN class="pln" >            include</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="pun" >[</SPAN></LI><LI class="L7" ><SPAN class="pln" >                </SPAN><SPAN class="str" >'mypackage/*'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L8" ><SPAN class="pln" >                </SPAN><SPAN class="str" >'havok/ready'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L9" ><SPAN class="pln" >                </SPAN><SPAN class="str" >'havok/router/started'</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L0" ><SPAN class="pln" >                </SPAN><SPAN class="str" >'havok/exception/started'</SPAN></LI><LI class="L1" ><SPAN class="pln" >            </SPAN><SPAN class="pun" >],</SPAN></LI><LI class="L2" ><SPAN class="pln" >            boot</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="lit" >1</SPAN></LI><LI class="L3" ><SPAN class="pln" >        </SPAN><SPAN class="pun" >}</SPAN></LI><LI class="L4" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >},</SPAN></LI><LI class="L5" ><SPAN class="pln" >    packages</SPAN><SPAN class="pun" >:[</SPAN></LI><LI class="L6" ><SPAN class="pln" >        </SPAN><SPAN class="pun" >{</SPAN></LI><LI class="L7" ><SPAN class="pln" >            name</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >"mypackage"</SPAN><SPAN class="pun" >,</SPAN></LI><LI class="L8" ><SPAN class="pln" >            location</SPAN><SPAN class="pun" >:</SPAN><SPAN class="pln" > </SPAN><SPAN class="str" >'../mypackage'</SPAN></LI><LI class="L9" ><SPAN class="pln" >        </SPAN><SPAN class="pun" >}</SPAN></LI><LI class="L0" ><SPAN class="pln" >    </SPAN><SPAN class="pun" >]</SPAN></LI><LI class="L1" ><SPAN class="pun" >}</SPAN></LI></OL></PRE></DIV></SECTION>    <SECTION id="make" title="Make" ><DIV class="well" ><H1 >Make</H1>
<P >Run the build using the <CODE >havok/build/make.js</CODE> script, with your build profile as an arguemnt. Eg:</P>
<PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="pln" >node path</SPAN><SPAN class="pun" >/</SPAN><SPAN class="pln" >to</SPAN><SPAN class="pun" >/</SPAN><SPAN class="pln" >havok</SPAN><SPAN class="pun" >/</SPAN><SPAN class="pln" >build</SPAN><SPAN class="pun" >/</SPAN><SPAN class="pln" >make</SPAN><SPAN class="pun" >.</SPAN><SPAN class="pln" >js path</SPAN><SPAN class="pun" >/</SPAN><SPAN class="pln" >to</SPAN><SPAN class="pun" >/</SPAN><SPAN class="kwd" >my</SPAN><SPAN class="pun" >.</SPAN><SPAN class="pln" >profile</SPAN><SPAN class="pun" >.</SPAN><SPAN class="pln" >js</SPAN></LI></OL></PRE>
<P >Builds do a lot of processing, and may take several minutes to complete.</P>
<P >During the build, a dojo build profile called <CODE >path/to/my.profile.processed.js</CODE> will be created. It contains the complete expanded build profile will all settings. You may wish to inspect this file. Any of the defaults can be overridden in <CODE >path/to/my.profile.js</CODE>.</P>
<P ><CODE >make.js</CODE> reads a profile and passes it through several stages of processing. Each of these stanges can be run separately from the command line, which may be useful when debuggin a build:</P>
<UL >    <LI ><CODE >node path/to/havok/build/ext/prepareReleaseDir.js path/to/my.profile.js</CODE>.</LI>    <LI ><CODE >node path/to/havok/build/ext/mixinDefault.js path/to/my.profile.js</CODE>.</LI>    <LI ><CODE >node path/to/havok/build/ext/fixupLocationsAndPaths.js path/to/my.profile.js</CODE>.</LI>    <LI ><CODE >node path/to/havok/build/ext/externalLess.js path/to/my.profile.js</CODE>.</LI>    <LI ><CODE >node path/to/havok/build/ext/expandPackageIncludes.js path/to/my.profile.js</CODE>.</LI>    <LI ><CODE >node path/to/havok/build/ext/mergeConfigs.js path/to/my.profile.js</CODE>.</LI>    <LI ><CODE >node path/to/havok/build/ext/build.js path/to/my.profile.js</CODE>.</LI>    <LI ><CODE >node path/to/havok/build/ext/compileLess.js path/to/my.profile.js</CODE>.</LI>    <LI ><CODE >node path/to/havok/build/ext/copyDist.js path/to/my.profile.js</CODE>.</LI></UL></DIV></SECTION>    <SECTION id="deploy" title="Deploy" ><DIV class="well" ><H1 >Deploy</H1>
<P >You built layers will be saved in the <CODE >distDir</CODE> defined in your build profile.</P>
<P >Place the following in your <CODE >head</CODE> tag to use your built layers:</P>
<PRE class="prettyprint linenums" ><OL class="linenums" ><LI class="L0" ><SPAN class="tag" >&lt;link</SPAN><SPAN class="pln" > </SPAN><SPAN class="atn" >rel</SPAN><SPAN class="pun" >=</SPAN><SPAN class="atv" >"stylesheet"</SPAN><SPAN class="pln" > </SPAN><SPAN class="atn" >href</SPAN><SPAN class="pun" >=</SPAN><SPAN class="atv" >"path/to/layer.css"</SPAN><SPAN class="tag" >&gt;</SPAN></LI><LI class="L1" ><SPAN class="tag" >&lt;script</SPAN><SPAN class="pln" > </SPAN><SPAN class="atn" >src</SPAN><SPAN class="pun" >=</SPAN><SPAN class="atv" >"path/to/bootable/layer.js"</SPAN><SPAN class="tag" >&gt;&lt;/script&gt;</SPAN></LI></OL></PRE><P >Note: these docs use a bootable havok layer. Take a look at the source to see.</P></DIV></SECTION>        </DIV>    </DIV></DIV>